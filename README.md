# 语音输入同步工具（这是Claude写的，不是我写的，简单来说，执行一键安装，然后就可以用了）
下面是一个效果展示，前端也是Gemini做的。用嘴写程序的时代来了，我本人只能说一点不懂代码（文科生）。
![3bd91710d4a53e1b2379f650b3091297](https://github.com/user-attachments/assets/2600c500-b943-4d4b-a3d6-56ae68ccbe09)

## 快速开始（Windows 用户）

### 前置要求
- 网络连接
- Windows 10/11（推荐，支持自动安装 Python）

### 🚀 极简模式（推荐新手）

**最简单的方式**：
```bash
1️⃣ 双击运行 一键安装.bat    # 自动安装 Python + 依赖（首次需要）
   ⚠️ 如果提示重启，请关闭窗口后重新运行一次
   
2️⃣ 双击运行 start.bat       # 启动服务
```

### 📝 分步模式（可选）

如果你想更清楚地了解每个步骤，可以分别运行：

```bash
1️⃣ 双击运行 install_python.bat    # 检查并安装 Python（首次需要）
   ⚠️ 如果安装了 Python，请关闭并重新打开命令行窗口
   
2️⃣ 双击运行 install.bat           # 安装程序依赖（首次需要）

3️⃣ 双击运行 start.bat             # 启动服务
```

就这么简单！服务启动后，用手机浏览器访问显示的地址即可。

### 📦 批处理文件说明

- **`一键安装.bat`**（推荐）：一次性完成所有安装步骤
  - 自动检查并安装 Python 3.12
  - 自动安装所有依赖包
  - 提供友好的错误提示
  
- **`install_python.bat`**：单独安装 Python
  - ✅ 优先使用 winget 自动安装（Windows 10/11）
  - ✅ 如果 winget 不可用，提供手动下载链接
  - ✅ 如果已安装 Python，会跳过此步骤
  
- **`install.bat`**：单独安装程序依赖包
  - 安装 aiohttp, pyautogui, pyperclip, pynput
  
- **`start.bat`**：启动服务器

---

## 功能特点

- **实时同步**：文字变化自动同步到电脑
- **纠错同步**：语音输入法修正文字时，电脑端也会同步修正
- **可配置延迟**：在手机端调整发送延迟，适配不同输入法
- **自动清空**：可设置输入停止后 N 秒自动清空
- **热键清空**：电脑端按热键触发手机清空
- **连续输入**：双回车清空后输入法不会收回

## 手动安装（高级用户）

如果你不想使用 `install.bat`，也可以手动安装：

```bash
pip install -r requirements.txt
```

### 依赖说明

| 库 | 用途 |
|---|---|
| aiohttp | WebSocket 服务器 |
| pyautogui | 模拟键盘输入/退格 |
| pyperclip | 剪贴板操作（中文输入） |
| pynput | 热键监听（可选） |

### macOS 额外步骤

首次运行需要授权：**系统偏好设置 → 安全性与隐私 → 辅助功能** 中允许终端/Python。

### Linux 额外步骤

```bash
sudo apt install xdotool xclip
```

## 使用

### 1. 启动服务

```bash
python server.py
```

启动后会显示：
```
==================================================
🚀 语音输入同步服务已启动
==================================================
📱 手机访问: http://192.168.1.100:5000
💻 本机访问: http://127.0.0.1:5000
==================================================
🎹 热键已启用: [f9]
```

### 2. 手机连接

1. 确保手机和电脑在同一 WiFi
2. 手机浏览器打开显示的地址
3. 点击文本框，使用输入法语音输入

### 3. 设置选项（手机端）

点击右上角 ⚙️ 打开设置：

| 选项 | 说明 |
|------|------|
| 发送延迟 | 文字变化后等待多久再同步（毫秒），建议 300-800 |
| 自动清空 | 输入停止后 N 秒自动清空，0 = 禁用 |

### 4. 清空文本框

三种方式：
1. **双回车**：快速按两次回车键（500ms 内）
2. **热键**：电脑端按 F9（可在代码中修改）
3. **自动清空**：设置延迟后自动触发

所有方式都不会收起输入法！

## 配置修改

编辑 `server.py` 顶部的 CONFIG：

```python
CONFIG = {
    'port': 5000,         # 服务端口
    'hotkey': 'f9',       # 清空热键，设为 '' 禁用
}
```

## 工作原理

### 差异同步算法

```
手机: "你号"     →  电脑: "你号"
手机: "你好"     →  电脑: 删除"号" + 输入"好" = "你好"
手机: "你好世界" →  电脑: 输入"世界" = "你好世界"
```

通过比较「已同步文本」和「当前文本」的最长公共前缀，计算需要：
1. 发送多少个退格键删除差异部分
2. 输入什么新内容

### 防抖机制

语音输入法会在输入过程中不断调整文字，设置延迟可以等待输入法稳定后再同步，避免发送中间状态。

## 常见问题

**Q: 中文输入不了？**
A: 中文使用剪贴板方式输入，确保电脑端光标在可输入的位置。

**Q: 热键不工作？**
A: 确保安装了 pynput，macOS 需要授权辅助功能权限。

**Q: 延迟设多少合适？**
A: 建议从 500ms 开始，根据你的输入法调整。如果经常出现纠错，可以增加到 800-1000ms。
